<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Telegram Commenting Control</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header-container { display: flex; justify-content: space-between; align-items: center; }
        .header-container h1 { color: #333; margin: 0; }
        .header-container form { margin: 0; }
        .error { color: #D8000C; background-color: #FFD2D2; border: 1px solid; margin: 10px 0px; padding:15px 10px 15px 10px; border-radius: 4px; }
        .success { color: #4F8A10; background-color: #DFF2BF; border: 1px solid; margin: 10px 0px; padding:15px 10px 15px 10px; border-radius: 4px; }
        .section { margin-bottom: 20px; }
        input, button { padding: 8px; margin: 5px; }
        ul { list-style-type: none; }
        li { margin: 5px 0; }
    </style>
</head>
<body>
    <div class="header-container section">
        <h1>Telegram Commenting Control</h1>
        <form action="{{ url_for('logout') }}" method="post">
            <button type="submit">Logout</button>
        </form>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="section">
        <h2>Add Account</h2>
        <form action="/send_code_request" method="post">
            <input type="text" name="phone" placeholder="Phone Number (+1...)" required>
            <button type="submit">Get Verification Code</button>
        </form>
        <form action="/add_account" method="post">
            <input type="text" name="phone" placeholder="Phone Number (+1...)" required>
            <input type="text" name="code" placeholder="Verification Code" required>
            <input type="password" name="password" placeholder="Password (optional)">
            <button type="submit">Add Account</button>
        </form>
    </div>
    <div class="section">
        <h2>Add Comment</h2>
        <form action="/add_comment" method="post">
            <input type="text" name="comment" placeholder="Comment Text" required>
            <button type="submit">Add Comment</button>
        </form>
    </div>
    <div class="section">
        <h2>Control</h2>
        <form action="/start" method="post">
            <button type="submit">Start</button>
        </form>
        <form action="/stop" method="post">
            <button type="submit">Stop</button>
        </form>
        <p>Status: {{ "Running" if is_running else "Stopped" }}</p>
    </div>
    <div class="section">
        <h2>Settings</h2>
        <form action="/update_settings" method="post">
            <label for="min_delay">Min Delay (s):</label>
            <input type="number" id="min_delay" name="min_delay" value="{{ config.MIN_DELAY }}" required>
            <br>
            <label for="max_delay">Max Delay (s):</label>
            <input type="number" id="max_delay" name="max_delay" value="{{ config.MAX_DELAY }}" required>
            <br>
            <label for="comment_chance">Comment Chance (%):</label>
            <input type="number" id="comment_chance" name="comment_chance" min="0" max="100" value="{{ config.COMMENT_CHANCE }}" required>
            <br>
            <button type="submit">Update Settings</button>
        </form>
    </div>
    <div class="section">
        <h2>Accounts</h2>
        <ul>
            {% for phone, account in accounts.items() %}
                <li>
                    {{ phone }} {{ "Signed In" if account.get("signed_in") else "Not Signed In"}}
                    <form action="/delete_account" method="post" style="display:inline;">
                        <input type="hidden" name="phone" value="{{ phone }}">
                        <button type="submit">Delete</button>
                    </form>
                </li>

            {% endfor %}
        </ul>
    </div>
    <div class="section">
        <h2>Comments</h2>
        <ul>
            {% for comment in comments %}
                <li>
                    {{ comment }}
                    <form action="/delete_comment" method="post" style="display:inline;">
                        <input type="hidden" name="comment" value="{{ comment }}">
                        <button type="submit">Delete</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    </div>
    <div class="section">
        <h2>Logs</h2>
        <ul>
            {% for log in logs %}
                <li>{{ log }}</li>
            {% endfor %}
        </ul>
    </div>
</body>
</html>